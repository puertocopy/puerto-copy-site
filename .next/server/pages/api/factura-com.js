"use strict";(()=>{var e={};e.id=221,e.ids=[221],e.modules={1663:(e,r,t)=>{t.r(r),t.d(r,{config:()=>c,default:()=>u,routeModule:()=>d});var o={};t.r(o),t.d(o,{default:()=>s});var a=t(3480),n=t(8667),i=t(6435);async function s(e,r){if("POST"!==e.method)return r.status(405).json({error:"M\xe9todo no permitido"});let{rfc:t,razonSocial:o,correo:a,cp:n,ticket:i,usoCfdi:s,regimenFiscal:u}=e.body;if(!t||!o||!a||!n||!i||!s||!u)return r.status(400).json({error:"Faltan campos requeridos"});try{let e=`Bearer ${process.env.FACTURA_API_KEY}`,c=await fetch(`${process.env.FACTURA_API_BASE_URL}/v4/cfdi40/create`,{method:"POST",headers:{Authorization:e,"Content-Type":"application/json"},body:JSON.stringify({receptor:{rfc:t,nombre:o,regimen_fiscal:u,uso_cfdi:s,codigo_postal:n,email:a},conceptos:[{clave_prod_serv:"01010101",cantidad:1,clave_unidad:"E48",unidad:"Servicio",descripcion:`Venta mostrador - Ticket ${i}`,valor_unitario:100,importe:100,objeto_impuesto:"02",impuestos:{traslados:[{base:100,impuesto:"002",tipo_factor:"Tasa",tasa_o_cuota:.16,importe:16}]}}],metodo_pago:"PUE",forma_pago:"01",serie:"A",folio:`T-${i}`,tipo_comprobante:"I",lugar_expedicion:n})}),d=await c.json();if(!c.ok)return r.status(c.status).json({error:"Error al generar factura",detalle:d});return r.status(200).json({success:!0,data:d})}catch(e){return console.error("❌ Error general:",e),r.status(500).json({error:"❌ Error al conectar con Factura.com",detalle:e.message})}}let u=(0,i.M)(o,"default"),c=(0,i.M)(o,"config"),d=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/factura-com",pathname:"/api/factura-com",bundlePath:"",filename:""},userland:o})},3480:(e,r,t)=>{e.exports=t(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=1663);module.exports=t})();